<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cdnu.cgi.mapper.UserComprehensiveInfoMapper">

    <!-- 结果映射 -->
    <resultMap id="BaseResultMap" type="com.cdnu.cgi.entity.UserComprehensiveInfo">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="username" property="username" jdbcType="VARCHAR"/>
        <result column="real_name" property="realName" jdbcType="VARCHAR"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="phone" property="phone" jdbcType="VARCHAR"/>
        <result column="major" property="major" jdbcType="VARCHAR"/>
        <result column="avatar_url" property="avatarUrl" jdbcType="VARCHAR"/>
        <result column="register_time" property="registerTime" jdbcType="TIMESTAMP"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="skills" property="skills" jdbcType="VARCHAR"/>
        <result column="honours" property="honours" jdbcType="VARCHAR"/>
    </resultMap>

    <!-- 基础列 -->
    <sql id="Base_Column_List">
        id, username, real_name, email, phone, major, avatar_url, register_time, status, skills, honours
    </sql>

    <!-- 根据ID查询 -->
    <select id="selectById" parameterType="java.lang.Long" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM user_comprehensive_info
        WHERE id = #{id}
    </select>

    <!-- 根据用户名查询 -->
    <select id="selectByUsername" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM user_comprehensive_info
        WHERE username = #{username}
    </select>

    <!-- 查询所有用户 -->
    <select id="selectAll" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM user_comprehensive_info
        ORDER BY id
    </select>

    <!-- 根据ID列表查询 -->
    <select id="selectByIds" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM user_comprehensive_info
        WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
        ORDER BY id
    </select>

    <!-- 根据专业查询 -->
    <select id="selectByMajor" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM user_comprehensive_info
        WHERE major = #{major}
        ORDER BY id
    </select>

    <!-- 根据技能查询 -->
    <select id="selectBySkill" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM user_comprehensive_info
        WHERE FIND_IN_SET(#{skill}, REPLACE(skills, ', ', ',')) > 0
        ORDER BY id
    </select>

    <!-- 搜索用户 -->
    <select id="searchUsers" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM user_comprehensive_info
        <where>
            <if test="keyword != null and keyword != ''">
                (username LIKE CONCAT('%', #{keyword}, '%')
                OR real_name LIKE CONCAT('%', #{keyword}, '%')
                OR major LIKE CONCAT('%', #{keyword}, '%')
                OR FIND_IN_SET(#{keyword}, REPLACE(skills, ', ', ',')) > 0)
            </if>
        </where>
        ORDER BY id
    </select>

    <!-- 分页查询 -->
    <select id="selectWithPagination" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM user_comprehensive_info
        ORDER BY id
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 统计用户总数 -->
    <select id="countUsers" resultType="int">
        SELECT COUNT(*) FROM user_comprehensive_info
    </select>

</mapper>